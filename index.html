<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Меню Ресторана</title>
    
    <style>
        /* --- ШРИФТ --- */
        @font-face {
            font-family: 'Masvol';
            src: url('cd-masvol-thin.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        /* --- ЦВЕТА --- */
        :root {
            --primary-color: #8B4513; 
            --bg-color: #000000; /* Глубокий черный */
            --text-font: 'Masvol', 'Playfair Display', serif; 
        }

        /* Сброс всех отступов браузера */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body { 
            background-color: var(--bg-color);
            height: 100vh; height: 100dvh; /* Поддержка динамической высоты мобилок */
            width: 100vw;
            overflow: hidden; /* Запрет скролла */
            display: flex; justify-content: center; align-items: center;
            font-family: var(--text-font);
            user-select: none; -webkit-user-select: none;
        }
        
        button { font-family: var(--text-font); cursor: pointer; outline: none; -webkit-tap-highlight-color: transparent; }

        /* Контейнер приложения */
        #app-frame {
            position: relative; 
            width: 100%; height: 100%; 
            background-color: var(--bg-color); 
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* Если открываем на компьютере - делаем рамку. На телефоне - на весь экран */
        @media (min-width: 451px) {
            #app-frame {
                max-width: 440px; 
                max-height: 900px;
                border: 1px solid #333;
                box-shadow: 0 0 50px rgba(0,0,0,0.5);
            }
        }

        /* === 1. ЗАСТАВКА (ЛЭНДИНГ) === */
        #landing-page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('1.webp') no-repeat center center/cover; 
            z-index: 50; 
            display: flex; flex-direction: column; justify-content: flex-end; align-items: center;
            padding-bottom: 50px;
            /* Учитываем отступ снизу для iPhone (полоска домой) */
            padding-bottom: calc(40px + env(safe-area-inset-bottom));
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .landing-hidden { opacity: 0; transform: scale(1.1); pointer-events: none; }
        
        #landing-page::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: -1;
        }

        .landing-categories {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;
            max-width: 90%; margin-bottom: 30px;
        }
        .cat-pill {
            background: rgba(60, 30, 20, 0.85); 
            border: 1px solid rgba(255,255,255,0.3);
            color: #ddd; padding: 12px 18px; border-radius: 30px;
            text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;
            transition: 0.2s; cursor: pointer;
        }
        .cat-pill:hover { background: var(--primary-color); border-color: var(--primary-color); color: white; transform: scale(1.05); }

        .btn-open {
            background: rgba(60, 30, 20, 0.95);
            border: 1px solid rgba(139, 69, 19, 0.6);
            color: white; font-size: 1.6rem; 
            padding: 15px 50px; border-radius: 12px; letter-spacing: 3px; 
            text-transform: uppercase; box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        .btn-open:active { transform: scale(0.96); }

        /* === 2. ПРОСМОТР МЕНЮ === */
        #viewer-page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            background-color: #000;
            opacity: 0; transition: opacity 0.6s ease; 
            z-index: 10; pointer-events: none;
        }
        
        .viewer-visible { opacity: 1 !important; pointer-events: auto !important; }

        /* Зоны клика (оставляем для тех, кто кликает) */
        .tap-layer {
            position: absolute; top: 60px; bottom: 80px; left: 0; width: 100%;
            z-index: 15; display: flex;
        }
        .tap-left { width: 50%; height: 100%; }
        .tap-right { width: 50%; height: 100%; }

        .top-bar-area {
            height: 60px; flex-shrink: 0; display: flex; align-items: center; padding-left: 20px;
            z-index: 20; position: absolute; top: 0; left: 0; width: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);
            padding-top: env(safe-area-inset-top); /* Отступ под челку */
        }
        .btn-menu {
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.3);
            color: #eee; padding: 8px 16px; text-transform: uppercase;
            font-size: 0.75rem; letter-spacing: 1px; border-radius: 6px;
            backdrop-filter: blur(4px); margin-top: 10px;
        }

        /* ОБЛАСТЬ ФОТО */
        .image-wrapper {
            flex-grow: 1; 
            width: 100%; 
            position: relative;
            display: flex; 
            align-items: center; 
            justify-content: center;
            overflow: hidden;
        }
        
        #current-image {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            display: block;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            opacity: 1;
            transform: translateX(0);
        }

        /* Анимации */
        .slide-out-left { transform: translateX(-30px) !important; opacity: 0 !important; }
        .slide-in-right { animation: enterRight 0.3s forwards; }
        .slide-out-right { transform: translateX(30px) !important; opacity: 0 !important; }
        .slide-in-left { animation: enterLeft 0.3s forwards; }

        @keyframes enterRight { from { transform: translateX(30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes enterLeft { from { transform: translateX(-30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .loader {
            position: absolute; width: 40px; height: 40px;
            border: 3px solid #333; border-top: 3px solid var(--primary-color);
            border-radius: 50%; animation: spin 0.8s linear infinite;
            z-index: -1;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Нижняя панель */
        .bottom-bar {
            height: auto; min-height: 70px; flex-shrink: 0; background-color: #5D2E1F; 
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 10px; color: rgba(255,255,255,0.95);
            font-size: 0.9rem; letter-spacing: 1px; text-transform: uppercase;
            border-top: 1px solid rgba(255,255,255,0.1); z-index: 20;
            
            /* Учитываем безопасную зону снизу (полоска iPhone) */
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
        }
        .nav-link { background: none; border: none; color: inherit; padding: 15px 25px; font-size: 1.5rem; }
        .nav-center { 
            font-size: 1rem; color: white; letter-spacing: 1px; white-space: nowrap; 
            cursor: pointer; padding: 10px; transition: transform 0.1s;
        }
        .nav-center:active { transform: scale(0.95); }
        .text-pop { animation: popText 0.3s ease; }
        @keyframes popText { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(0.9); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; } }

        /* === БОКОВОЕ МЕНЮ === */
        #sidebar {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 10, 10, 0.98); z-index: 100;
            transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex; flex-direction: column; 
            padding-top: calc(60px + env(safe-area-inset-top)); /* Отступ сверху */
        }
        #sidebar.open { transform: translateX(0); }

        .sidebar-item {
            padding: 20px 30px; border-bottom: 1px solid rgba(255,255,255,0.08);
            color: #eee; font-size: 1.2rem; text-transform: uppercase;
            letter-spacing: 1px; cursor: pointer;
            opacity: 0; transform: translateX(-20px); transition: 0.3s;
        }
        #sidebar.open .sidebar-item { opacity: 1; transform: translateX(0); }
        
        /* Задержки (Stagger) */
        #sidebar.open .sidebar-item:nth-child(1) { transition-delay: 0.05s; }
        #sidebar.open .sidebar-item:nth-child(2) { transition-delay: 0.1s; }
        #sidebar.open .sidebar-item:nth-child(3) { transition-delay: 0.15s; }
        #sidebar.open .sidebar-item:nth-child(4) { transition-delay: 0.2s; }
        #sidebar.open .sidebar-item:nth-child(5) { transition-delay: 0.25s; }
        #sidebar.open .sidebar-item:nth-child(6) { transition-delay: 0.3s; }
        #sidebar.open .sidebar-item:nth-child(7) { transition-delay: 0.35s; }
        #sidebar.open .sidebar-item:nth-child(8) { transition-delay: 0.4s; }
        #sidebar.open .sidebar-item:nth-child(9) { transition-delay: 0.45s; }
        #sidebar.open .sidebar-item:nth-child(10) { transition-delay: 0.5s; }

        .sidebar-item:first-child { border-top: 1px solid rgba(255,255,255,0.08); }
        .sidebar-item:hover { background: rgba(139, 69, 19, 0.3); padding-left: 40px; }
        
        .close-menu-area { 
            position: absolute; top: calc(20px + env(safe-area-inset-top)); 
            right: 25px; font-size: 2.5rem; cursor: pointer; color: #888; 
        }

    </style>
</head>
<body>

    <div id="app-frame">
        
        <div id="landing-page">
            <div class="landing-categories" id="landing-cats"></div>
            <button class="btn-open" onclick="startApp()">ОТКРЫТЬ</button>
        </div>

        <div id="viewer-page">
            <div class="top-bar-area">
                <button class="btn-menu" onclick="toggleMenu()">Меню</button>
            </div>

            <div class="tap-layer">
                <div class="tap-left" onclick="changeSlide(-1)"></div>
                <div class="tap-right" onclick="changeSlide(1)"></div>
            </div>

            <div class="image-wrapper">
                <div class="loader"></div>
                <img id="current-image" src="" alt="Меню">
            </div>
            
            <div class="bottom-bar">
                <button class="nav-link" onclick="changeSlide(-1)">←</button>
                <div class="nav-center" id="page-indicator" onclick="goHome()">...</div>
                <button class="nav-link" onclick="changeSlide(1)">→</button>
            </div>
        </div>

        <div id="sidebar">
            <div class="close-menu-area" onclick="toggleMenu()">×</div>
            <div id="sidebar-list"></div>
        </div>

    </div>

    <script>
        const menuData = [
            { src: '2.webp', category: 'Завтраки' }, 
            { src: '3.webp', category: 'Завтраки' }, 
            { src: '4.webp', category: 'Завтраки' },
            { src: '5.webp', category: 'Пицца' },
            { src: '6.webp', category: 'Пицца' },
            { src: '7.webp', category: 'Пицца' },
            { src: '8.webp', category: 'Пицца' },
            { src: '9.webp', category: 'Закуски' },
            { src: '10.webp', category: 'Закуски' },
            { src: '11.webp', category: 'Закуски' },
            { src: '12.webp', category: 'Салаты' },
            { src: '13.webp', category: 'Салаты' },
            { src: '14.webp', category: 'Салаты' },
            { src: '15.webp', category: 'Паста' },
            { src: '16.webp', category: 'Первые блюда' },
            { src: '17.webp', category: 'Вторые блюда' },
            { src: '18.webp', category: 'Вторые блюда' },
            { src: '19.webp', category: 'Детское меню' },
            /* 20.webp удален, так как дублировал контент */
            { src: '21.webp', category: 'Десерты' },
            { src: '22.webp', category: 'Десерты' }
        ];

        let currentIndex = 0;
        const totalPages = menuData.length;
        
        const landingPage = document.getElementById('landing-page');
        const viewerPage = document.getElementById('viewer-page');
        const sidebar = document.getElementById('sidebar');
        const imgElement = document.getElementById('current-image');
        const indicator = document.getElementById('page-indicator');

        const categories = [...new Set(menuData.map(item => item.category))];

        function init() {
            const landingCatsContainer = document.getElementById('landing-cats');
            categories.forEach(cat => {
                const btn = document.createElement('div');
                btn.className = 'cat-pill';
                btn.innerText = cat;
                btn.onclick = () => { startApp(); jumpToCategory(cat); };
                landingCatsContainer.appendChild(btn);
            });

            const sidebarList = document.getElementById('sidebar-list');
            categories.forEach(cat => {
                const item = document.createElement('div');
                item.className = 'sidebar-item';
                item.innerText = cat;
                item.onclick = () => { jumpToCategory(cat); toggleMenu(); };
                sidebarList.appendChild(item);
            });
            
            preloadImage(currentIndex);
            initSwipe(); // Инициализация свайпов
        }

        function startApp() {
            landingPage.classList.add('landing-hidden');
            viewerPage.classList.add('viewer-visible');
        }

        function goHome() {
            landingPage.classList.remove('landing-hidden');
            viewerPage.classList.remove('viewer-visible');
        }

        let isAnimating = false;

        function changeSlide(direction) {
            if (isAnimating) return;
            isAnimating = true;

            const nextIndex = getNextIndex(direction);
            
            if (direction > 0) {
                imgElement.className = 'slide-out-left'; 
            } else {
                imgElement.className = 'slide-out-right';
            }
            
            indicator.classList.remove('text-pop');
            void indicator.offsetWidth; 
            indicator.classList.add('text-pop');

            setTimeout(() => {
                currentIndex = nextIndex;
                updateImageSource();

                if (direction > 0) {
                    imgElement.className = 'slide-in-right'; 
                } else {
                    imgElement.className = 'slide-in-left'; 
                }

                preloadNext();

                setTimeout(() => { isAnimating = false; }, 300);
            }, 300);
        }

        function jumpToCategory(catName) {
            const index = menuData.findIndex(item => item.category === catName);
            if (index !== -1) {
                imgElement.style.opacity = 0;
                setTimeout(() => {
                    currentIndex = index;
                    updateImageSource();
                    imgElement.className = ''; 
                    imgElement.style.opacity = 1; 
                }, 200);
            }
        }

        function updateImageSource() {
            const item = menuData[currentIndex];
            imgElement.src = item.src;
            const currentNum = (currentIndex + 1).toString().padStart(2, '0');
            indicator.innerText = `${currentNum} / ${item.category}`;
        }

        function getNextIndex(direction) {
            let idx = currentIndex + direction;
            if (idx >= totalPages) idx = 0;
            if (idx < 0) idx = totalPages - 1;
            return idx;
        }

        function preloadImage(idx) {
            const img = new Image();
            img.src = menuData[idx].src;
            if (idx === currentIndex) updateImageSource();
        }

        function preloadNext() {
            let next = currentIndex + 1;
            if (next < totalPages) {
                const img = new Image();
                img.src = menuData[next].src;
            }
        }

        function toggleMenu() {
            sidebar.classList.toggle('open');
        }

        // --- ЛОГИКА СВАЙПОВ (Листание пальцем) ---
        function initSwipe() {
            let touchStartX = 0;
            let touchEndX = 0;
            const minSwipeDistance = 50; // Чувствительность свайпа

            viewerPage.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            }, {passive: true});

            viewerPage.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipeGesture();
            }, {passive: true});

            function handleSwipeGesture() {
                if (sidebar.classList.contains('open')) return; // Не листать, если открыто меню

                const diff = touchEndX - touchStartX;

                if (Math.abs(diff) > minSwipeDistance) {
                    if (diff < 0) {
                        changeSlide(1); // Влево (след.)
                    } else {
                        changeSlide(-1); // Вправо (пред.)
                    }
                }
            }
        }

        init();
    </script>
</body>
</html>
